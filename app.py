from flask import Flask, request, jsonify
from flask_cors import CORS
import os
import requests
import json # JSON ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§á‡§Æ‡•ç‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç
from dotenv import load_dotenv

app = Flask(__name__)
load_dotenv() # .env ‡§´‡§º‡§æ‡§á‡§≤ ‡§∏‡•á ‡§è‡§®‡•ç‡§µ‡§æ‡§Ø‡§∞‡§Æ‡•á‡§Ç‡§ü ‡§µ‡•á‡§∞‡§ø‡§è‡§¨‡§≤‡•ç‡§∏ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
CORS(app) # CORS ‡§á‡§®‡•á‡§¨‡§≤ ‡§ï‡§∞‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§´‡•ç‡§∞‡§Ç‡§ü‡§è‡§Ç‡§° ‡§∏‡•á ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§Ü ‡§∏‡§ï‡•á

# ‡§Ö‡§™‡§®‡•Ä Groq API ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§Ø‡§π‡§æ‡§Ç ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
API_KEY = os.getenv("GROQ_API_KEY")

@app.route("/", methods=["GET"])
def home():
    """‡§¨‡•á‡§∏‡§ø‡§ï ‡§π‡•ã‡§Æ ‡§∞‡•Ç‡§ü ‡§Ø‡§π ‡§ú‡§æ‡§Ç‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§ø API ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç‡•§"""
    return "üß† Groq Chatbot API is running!"

@app.route("/chat", methods=["POST"])
def chat():
    """
    ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡•á ‡§®‡•á‡§ö‡•Å‡§∞‡§≤ ‡§≤‡•à‡§Ç‡§ó‡•ç‡§µ‡•á‡§ú ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡•ã ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§î‡§∞ Groq API ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á
    ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§è‡§ï‡•ç‡§∂‡§®‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§§‡§æ ‡§π‡•à‡•§
    """
    data = request.json
    
    # ‡§´‡•ç‡§∞‡§Ç‡§ü‡§è‡§Ç‡§° ‡§∏‡•á 'message' (‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§Æ‡§æ‡§Ç‡§°) ‡§î‡§∞ 'excelData' ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
    user_msg = data.get("message", "") 
    excel_data = data.get("excelData", {}) 

    if not user_msg:
        return jsonify({"error": "No message provided"}), 400

    # AI ‡§ï‡•ã ‡§¶‡§ø‡§è ‡§ú‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§™‡•ç‡§∞‡•â‡§Æ‡•ç‡§™‡•ç‡§ü ‡§ï‡•ã ‡§î‡§∞ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§ï‡§∞‡•á‡§Ç
    # ‡§â‡§∏‡•á ‡§¨‡§§‡§æ‡§è‡§Ç ‡§ï‡§ø ‡§µ‡§π ‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§ë‡§™‡§∞‡•á‡§∂‡§® ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§î‡§∞ JSON ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§ï‡•à‡§∏‡•á ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á
    system_prompt = """
    ‡§Ü‡§™ ‡§è‡§ï ‡§¨‡§π‡•Å‡§§ ‡§π‡•Ä ‡§¨‡•Å‡§¶‡•ç‡§ß‡§ø‡§Æ‡§æ‡§® ‡§î‡§∞ ‡§ï‡•Å‡§∂‡§≤ ‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™‡§ï‡§æ ‡§ï‡§æ‡§Æ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•á ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§è ‡§ó‡§è ‡§ï‡§Æ‡§æ‡§Ç‡§°‡•ç‡§∏ ‡§ï‡•ã ‡§∏‡§Æ‡§ù‡§®‡§æ ‡§î‡§∞ ‡§â‡§®‡•ç‡§π‡•á‡§Ç JSON ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§è‡§ï‡•ç‡§∂‡§®‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§®‡§æ ‡§π‡•à‡•§
    ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡•á ‡§Ü‡§™‡§ï‡•ã ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§ó‡•ç‡§∞‡§ø‡§° ‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§Ü‡§™ ‡§ó‡§£‡§®‡§æ ‡§Ø‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

    ‡§Ü‡§™‡§ï‡•á ‡§ú‡§µ‡§æ‡§¨ ‡§Æ‡•á‡§Ç ‡§è‡§ï 'actions' ‡§®‡§æ‡§Æ ‡§ï‡•Ä JSON ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è‡•§ ‡§π‡§∞ ‡§è‡§ï‡•ç‡§∂‡§® ‡§ë‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§Æ‡•á‡§Ç 'action' ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ (‡§ú‡•à‡§∏‡•á 'sum', 'average', 'write', 'highlight', 'sort', 'filter') ‡§î‡§∞ ‡§â‡§∏ ‡§è‡§ï‡•ç‡§∂‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞‡•ç‡§∏ ‡§π‡•ã‡§®‡•á ‡§ö‡§æ‡§π‡§ø‡§è‡•§

    ‡§∏‡§Æ‡§∞‡•ç‡§•‡§ø‡§§ ‡§è‡§ï‡•ç‡§∂‡§® ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§î‡§∞ ‡§â‡§®‡§ï‡•á ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§ø‡§§ ‡§™‡•à‡§∞‡§æ‡§Æ‡•Ä‡§ü‡§∞‡•ç‡§∏:
    1.  **sum**: ‡§∞‡•á‡§Ç‡§ú ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§
        -   `action`: "sum"
        -   `range`: ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó (‡§ú‡•à‡§∏‡•á "A1:A10")
        -   `target`: ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó (‡§µ‡§π ‡§∏‡•á‡§≤ ‡§ú‡§π‡§æ‡§Å ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡§®‡§æ ‡§π‡•à, ‡§ú‡•à‡§∏‡•á "A11")
        ‡§â‡§¶‡§æ‡§π‡§∞‡§£:
        ‡§Ø‡•Ç‡§ú‡§∞: "A1 ‡§∏‡•á A5 ‡§ú‡•ã‡§°‡§º‡•ã ‡§î‡§∞ A6 ‡§Æ‡•á‡§Ç ‡§≤‡§ø‡§ñ‡•ã"
        ‡§Ü‡§™‡§ï‡§æ JSON: `{"actions": [{"action": "sum", "range": "A1:A5", "target": "A6"}]}`

    2.  **average**: ‡§∞‡•á‡§Ç‡§ú ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§î‡§∏‡§§ ‡§®‡§ø‡§ï‡§æ‡§≤‡§§‡§æ ‡§π‡•à‡•§
        -   `action`: "average"
        -   `range`: ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó (‡§ú‡•à‡§∏‡•á "B1:B10")
        -   `target`: ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó (‡§µ‡§π ‡§∏‡•á‡§≤ ‡§ú‡§π‡§æ‡§Å ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡§®‡§æ ‡§π‡•à, ‡§ú‡•à‡§∏‡•á "B11")
        ‡§â‡§¶‡§æ‡§π‡§∞‡§£:
        ‡§Ø‡•Ç‡§ú‡§∞: "B1 ‡§∏‡•á B5 ‡§ï‡§æ ‡§î‡§∏‡§§ ‡§®‡§ø‡§ï‡§æ‡§≤‡•ã ‡§î‡§∞ B6 ‡§Æ‡•á‡§Ç ‡§≤‡§ø‡§ñ‡•ã"
        ‡§Ü‡§™‡§ï‡§æ JSON: `{"actions": [{"action": "average", "range": "B1:B5", "target": "B6"}]}`

    3.  **write**: ‡§ï‡§ø‡§∏‡•Ä ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§∏‡•á‡§≤ ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§Æ‡§æ‡§® ‡§≤‡§ø‡§ñ‡§§‡§æ ‡§π‡•à‡•§
        -   `action`: "write"
        -   `target`: ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó (‡§µ‡§π ‡§∏‡•á‡§≤ ‡§ú‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡§®‡§æ ‡§π‡•à, ‡§ú‡•à‡§∏‡•á "C1")
        -   `value`: ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§Æ‡§æ‡§® (‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó, ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ) ‡§ú‡§ø‡§∏‡•á ‡§≤‡§ø‡§ñ‡§®‡§æ ‡§π‡•à‡•§
        ‡§â‡§¶‡§æ‡§π‡§∞‡§£:
        ‡§Ø‡•Ç‡§ú‡§∞: "D2 ‡§Æ‡•á‡§Ç '‡§Æ‡•á‡§∞‡§æ ‡§°‡•á‡§ü‡§æ' ‡§≤‡§ø‡§ñ‡•ã"
        ‡§Ü‡§™‡§ï‡§æ JSON: `{"actions": [{"action": "write", "target": "D2", "value": "‡§Æ‡•á‡§∞‡§æ ‡§°‡•á‡§ü‡§æ"}]}`
        ‡§Ø‡•Ç‡§ú‡§∞: "E3 ‡§Æ‡•á‡§Ç 123 ‡§≤‡§ø‡§ñ‡•ã"
        ‡§Ü‡§™‡§ï‡§æ JSON: `{"actions": [{"action": "write", "target": "E3", "value": 123}]}`

    4.  **highlight**: ‡§è‡§ï ‡§Ø‡§æ ‡§Ö‡§ß‡§ø‡§ï ‡§∏‡•á‡§≤‡•ç‡§∏ ‡§ï‡•ã ‡§π‡§æ‡§á‡§≤‡§æ‡§á‡§ü ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§
        -   `action`: "highlight"
        -   `range`: ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó (‡§ú‡•à‡§∏‡•á "A1" ‡§Ø‡§æ "A1:C5")
        -   `color`: ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó (CSS ‡§∞‡§Ç‡§ó ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§Ø‡§æ ‡§π‡•á‡§ï‡•ç‡§∏ ‡§ï‡•ã‡§°, ‡§ú‡•à‡§∏‡•á "yellow", "#FFFF00", "lightgreen")
        ‡§â‡§¶‡§æ‡§π‡§∞‡§£:
        ‡§Ø‡•Ç‡§ú‡§∞: "F1 ‡§∏‡•á G5 ‡§§‡§ï ‡§™‡•Ä‡§≤‡§æ ‡§ï‡§∞‡•ã"
        ‡§Ü‡§™‡§ï‡§æ JSON: `{"actions": [{"action": "highlight", "range": "F1:G5", "color": "yellow"}]}`

    5.  **sort**: ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•â‡§≤‡§Æ ‡§ï‡•ã ‡§∏‡•â‡§∞‡•ç‡§ü ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§
        -   `action`: "sort"
        -   `column`: ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó (‡§ï‡•â‡§≤‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ, ‡§ú‡•à‡§∏‡•á "A")
        -   `order`: ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó ("asc" (‡§Ü‡§∞‡•ã‡§π‡•Ä) ‡§Ø‡§æ "desc" (‡§Ö‡§µ‡§∞‡•ã‡§π‡•Ä))
        ‡§â‡§¶‡§æ‡§π‡§∞‡§£:
        ‡§Ø‡•Ç‡§ú‡§∞: "‡§ï‡•â‡§≤‡§Æ A ‡§ï‡•ã ‡§Ü‡§∞‡•ã‡§π‡•Ä ‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç ‡§∏‡•â‡§∞‡•ç‡§ü ‡§ï‡§∞‡•ã"
        ‡§Ü‡§™‡§ï‡§æ JSON: `{"actions": [{"action": "sort", "column": "A", "order": "asc"}]}`

    6.  **filter**: ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•â‡§≤‡§Æ ‡§ï‡•ã ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§
        -   `action`: "filter"
        -   `column`: ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó (‡§ï‡•â‡§≤‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ, ‡§ú‡•à‡§∏‡•á "A")
        -   `value`: ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó ‡§Ø‡§æ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ (‡§ú‡§ø‡§∏ ‡§Æ‡§æ‡§® ‡§™‡§∞ ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡§®‡§æ ‡§π‡•à)
        ‡§â‡§¶‡§æ‡§π‡§∞‡§£:
        ‡§Ø‡•Ç‡§ú‡§∞: "‡§ï‡•â‡§≤‡§Æ B ‡§Æ‡•á‡§Ç '‡§™‡•Ç‡§∞‡•ç‡§£' ‡§µ‡§æ‡§≤‡•á ‡§ï‡•ã ‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•ã"
        ‡§Ü‡§™‡§ï‡§æ JSON: `{"actions": [{"action": "filter", "column": "B", "value": "‡§™‡•Ç‡§∞‡•ç‡§£"}]}`


    ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§¨‡§æ‡§§‡•á‡§Ç:
    -   ‡§π‡§Æ‡•á‡§∂‡§æ ‡§µ‡•à‡§ß JSON ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü ‡§¶‡•á‡§Ç‡•§ ‡§ï‡•ã‡§à ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§Ø‡§æ ‡§Æ‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§®‡§π‡•Ä‡§Ç‡•§
    -   ‡§Ø‡§¶‡§ø ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§Æ‡•á‡§Ç ‡§ï‡§à ‡§è‡§ï‡•ç‡§∂‡§®‡•ç‡§∏ ‡§π‡•à‡§Ç, ‡§§‡•ã 'actions' ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§∏‡§≠‡•Ä ‡§è‡§ï‡•ç‡§∂‡§®‡•ç‡§∏ ‡§ï‡•ã ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§ï‡§∞‡•á‡§Ç‡•§
    -   ‡§Ø‡§¶‡§ø ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡§æ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§ï‡§ø‡§∏‡•Ä ‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§è‡§ï‡•ç‡§∂‡§® ‡§∏‡•á ‡§Æ‡•á‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§ñ‡§æ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø, ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü `reply` (‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó) ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§á‡§∏ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Æ‡•á‡§Ç 'actions' ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•ã‡§ó‡•Ä ‡§Ø‡§æ ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§ó‡•Ä‡•§
    -   ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§§‡•á ‡§∏‡§Æ‡§Ø, ‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§°‡•á‡§ü‡§æ (‡§ú‡•ã ‡§Ü‡§™‡§ï‡•ã ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à) ‡§ï‡•ã ‡§∏‡•Ä‡§ß‡•á ‡§¶‡•ã‡§π‡§∞‡§æ‡§è‡§Ç ‡§®‡§π‡•Ä‡§Ç‡•§ ‡§â‡§∏‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•á‡§µ‡§≤ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§∞‡•á‡§Ç‡•§
    ‡§Ö‡§¨ ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§ï‡§Æ‡§æ‡§Ç‡§° ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§
    """

    # ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§î‡§∞ ‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§°‡•á‡§ü‡§æ ‡§¶‡•ã‡§®‡•ã‡§Ç Groq ‡§ï‡•ã ‡§≠‡•á‡§ú‡•á‡§Ç
    # excelData ‡§ï‡•ã JSON ‡§∏‡•ç‡§ü‡•ç‡§∞‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§≠‡•á‡§ú‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø AI ‡§â‡§∏‡•á ‡§™‡§¢‡§º ‡§∏‡§ï‡•á
    full_user_message = f"User Command: {user_msg}\n\nCurrent Excel Data:\n{json.dumps(excel_data, indent=2)}"

    api_payload = {
        "model": "llama3-8b-8192", # ‡§Ü‡§™ ‡§Ø‡§π‡§æ‡§Ç ‡§è‡§ï ‡§î‡§∞ ‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä ‡§Æ‡•â‡§°‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§Ø‡§¶‡§ø ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•ã
        "messages": [
            {"role": "system", "content": system_prompt},
            {"role": "user", "content": full_user_message}
        ],
        "temperature": 0.0 # AI ‡§ï‡•ã ‡§Ö‡§ß‡§ø‡§ï ‡§∏‡§ü‡•Ä‡§ï ‡§î‡§∞ ‡§ï‡§Æ ‡§∞‡§ö‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è
    }

    headers = {
        "Authorization": f"Bearer {API_KEY}",
        "Content-Type": "application/json"
    }

    try:
        res = requests.post(
            "https://api.groq.com/openai/v1/chat/completions",
            headers=headers,
            json=api_payload,
            timeout=20 # API ‡§ü‡§æ‡§á‡§Æ‡§Ü‡§â‡§ü ‡§¨‡§¢‡§º‡§æ‡§è‡§Ç
        )
        res.raise_for_status() # HTTP ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§µ‡§æ‡§¶ ‡§â‡§†‡§æ‡§è‡§Ç
        
        # Groq ‡§∏‡•á ‡§Æ‡§ø‡§≤‡§æ ‡§™‡•Ç‡§∞‡§æ JSON ‡§∞‡§ø‡§∏‡•ç‡§™‡§æ‡§Ç‡§∏ ‡§≤‡•á‡§Ç
        groq_response_content = res.json()["choices"][0]["message"]["content"]
        
        # AI ‡§ï‡•á ‡§ú‡§µ‡§æ‡§¨ ‡§ï‡•ã JSON ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§∞‡•ç‡§∏ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç
        try:
            parsed_response = json.loads(groq_response_content)
            # ‡§Ö‡§ó‡§∞ 'actions' ‡§ï‡•Ä ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§π‡•à, ‡§§‡•ã ‡§â‡§∏ ‡§ë‡§¨‡•ç‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡•ã ‡§≠‡•á‡§ú‡•á‡§Ç
            if "actions" in parsed_response and isinstance(parsed_response["actions"], list):
                return jsonify(parsed_response)
            else:
                # ‡§Ö‡§ó‡§∞ AI ‡§®‡•á JSON ‡§¶‡§ø‡§Ø‡§æ ‡§≤‡•á‡§ï‡§ø‡§® ‡§â‡§∏‡§Æ‡•á‡§Ç ‡§µ‡•à‡§ß 'actions' ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à
                return jsonify({"reply": groq_response_content})
        except json.JSONDecodeError:
            # ‡§Ö‡§ó‡§∞ AI ‡§®‡•á JSON ‡§ï‡•á ‡§Ö‡§≤‡§æ‡§µ‡§æ ‡§ï‡•Å‡§õ ‡§î‡§∞ ‡§¶‡§ø‡§Ø‡§æ
            return jsonify({"reply": groq_response_content})

    except requests.exceptions.Timeout:
        return jsonify({"error": "Groq API timeout", "message": "The AI took too long to respond."}), 504
    except requests.exceptions.RequestException as e:
        # Groq API ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§Ö‡§®‡•ç‡§Ø HTTP ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡§Ø‡§æ‡§Ç
        return jsonify({"error": "Groq API request failed", "details": str(e)}), 500
    except Exception as e:
        # ‡§ï‡•ã‡§à ‡§Ö‡§®‡•ç‡§Ø ‡§Ö‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§∂‡§ø‡§§ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø
        return jsonify({"error": "An unexpected error occurred", "details": str(e)}), 500

if __name__ == '__main__':
    # Python ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§ï‡•ã ‡§ö‡§≤‡§æ‡§è‡§Ç
    # ‡§π‡•ã‡§∏‡•ç‡§ü ‡§ï‡•ã '0.0.0.0' ‡§™‡§∞ ‡§∏‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§Ø‡§π ‡§≤‡•ã‡§ï‡§≤ ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§Æ‡•á‡§Ç ‡§è‡§ï‡•ç‡§∏‡•á‡§∏‡§ø‡§¨‡§≤ ‡§π‡•ã ‡§ú‡§æ‡§§‡§æ ‡§π‡•à
    # ‡§™‡•ã‡§∞‡•ç‡§ü 10000 ‡§™‡§∞ ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à
    app.run(host="0.0.0.0", port=10000, debug=True) # debug=True ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó‡•Ä ‡§π‡•à
